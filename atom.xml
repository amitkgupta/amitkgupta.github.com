<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Amit's Blog]]></title>
  <link href="http://akgupta.ca/atom.xml" rel="self"/>
  <link href="http://akgupta.ca/"/>
  <updated>2013-06-02T12:50:20-07:00</updated>
  <id>http://akgupta.ca/</id>
  <author>
    <name><![CDATA[Amit Kumar Gupta]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Yo Dawg, I Herd You Like Math]]></title>
    <link href="http://akgupta.ca/blog/2013/06/02/yo-dawg/"/>
    <updated>2013-06-02T12:23:00-07:00</updated>
    <id>http://akgupta.ca/blog/2013/06/02/yo-dawg</id>
    <content type="html"><![CDATA[<p>I’ve been playing around with R lately, and recently learned about <a href="http://yihui.name/knitr/">knitr</a>. It’s an R package which takes a LaTeX file with embedded R, and produces a pure LaTeX file (similar to how Rails renders an <code>.html.erb</code> file into a <code>.html</code> file), where the resulting LaTeX file has the output of the R code. It makes it super easy to embed statistical calculations, graphs, and all the good stuff R gives you right into your TeX files. I’ve got a <a href="https://github.com/amitkgupta/knit_tds">little project</a> which:</p>
<ol type="1">
<li>Runs a Python script which will use Selenium to scrape a web page for 2012 NFL passing statistics.</li>
<li>“Knits” a TeX file with embedded R that cleans the raw scraped data, produces a histogram of touchown passes for teams, and displays the teams with the least and greatest number of touchdowns.</li>
<li>Compiles the resulting TeX file and opens the resulting PDF.</li>
<li>Cleans up any temporary work files.</li>
</ol>
<p>Here’s what the pre-“knitted” LaTeX looks like with the embedded R:</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='latex'><span class='line'><span class="k">\documentclass</span><span class="nb">{</span>article<span class="nb">}</span>
</span><span class='line'><span class="k">\usepackage</span><span class="nb">{</span>graphicx<span class="nb">}</span>
</span><span class='line'><span class="c">%% begin.rcode setup, include=FALSE</span>
</span><span class='line'><span class="c">% opts_chunk$set(fig.path=&#39;figure/latex-&#39;, cache.path=&#39;cache/latex-&#39;)</span>
</span><span class='line'><span class="c">%% end.rcode</span>
</span><span class='line'><span class="k">\begin</span><span class="nb">{</span>document<span class="nb">}</span>
</span><span class='line'>
</span><span class='line'>After scraping data for all passing TDs in 2012, we get the following histogram for number of TD passes by team.
</span><span class='line'>
</span><span class='line'><span class="c">%% begin.rcode cache=TRUE</span>
</span><span class='line'><span class="c">% scrape &lt;- read.csv(&#39;scrape.csv&#39;)</span>
</span><span class='line'><span class="c">% raw_data &lt;- scrape[scrape[,&quot;X&quot;]!=&quot;&quot;,]</span>
</span><span class='line'><span class="c">% tds_for_passers &lt;- transform(raw_data[c(&quot;Tm&quot;,&quot;TD&quot;)], TD = as.numeric(as.character(TD)))</span>
</span><span class='line'><span class="c">% tds_for_teams &lt;- aggregate(tds_for_passers$TD, by=list(Team=tds_for_passers$Tm), FUN=sum)</span>
</span><span class='line'><span class="c">% hist(tds_for_teams$x)</span>
</span><span class='line'><span class="c">%% end.rcode</span>
</span><span class='line'>
</span><span class='line'>The teams with the greatest and least TDs:
</span><span class='line'>
</span><span class='line'><span class="c">%% begin.rcode</span>
</span><span class='line'><span class="c">% low_high &lt;- c(which.min(tds_for_teams$x), which.max(tds_for_teams$x))</span>
</span><span class='line'><span class="c">% tds_for_teams[low_high,&quot;Team&quot;]</span>
</span><span class='line'><span class="c">%% end.rcode</span>
</span><span class='line'>
</span><span class='line'><span class="k">\end</span><span class="nb">{</span>document<span class="nb">}</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>You can comment out the line in the <code>factory</code> script that deletes the <code>tds2012-out.tex</code> file if you want to see what it looks like post-knit. The resulting TeX file basically contains a ton of new commonad definitions but the meat of it is what it does with your R code. It formats and displays the R code itself, and then it displays the output of the R code. Wherever the output is a graph, you’ll see <code>\includegraphics[...]{...}</code>. knitr will do the R computation, render the graphics, create a <code>figures</code> subdirectory and store them there for the <code>\includegraphics</code> to reference. Whenever the output is simply text or mathematical expressions, you’ll see the R output translated to pure LaTeX markup.</p>
<p>Pretty cool stuff!</p>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Is it possible to be 15% Swedish?]]></title>
    <link href="http://akgupta.ca/blog/2013/05/19/is-it-possible-to-be-15-percent-swedish/"/>
    <updated>2013-05-19T13:32:00-07:00</updated>
    <id>http://akgupta.ca/blog/2013/05/19/is-it-possible-to-be-15-percent-swedish</id>
    <content type="html"><![CDATA[<p>This question came up as a joke during a team standup a few months ago. Although the obvious answer is “no,” if you’re willing to play fast and loose with your metaphysics for a bit, the answer can be “yes” and there’s a cute solution that ties together binary numbers and binary trees. This post itself is a bit of a joke in that it’s just for fun, but it might be nice to see the familiar concepts of binary numbers and binary trees in a new light.</p>
<h2 id="the-obvious-answer-is-no">The obvious answer is “no”</h2>
<p>Let’s quickly see why the real life answer is “no.” But first we should lay out the assumptions implicit in the problem. We’re going to assume that at some point in time, everyone was either entirely Swedish or entirely non-Swedish. There’s a chicken-and-egg problem that we’re sweeping under the rug here, but that’s what rugs are for. Next we’re assuming that every person after that point in time has their Swedishness wholly and equally determined by their parents Swedishness. So if mom is 17% Swedish and dad is 66% Swedish, then baby is ½ x 17% + ½ x 66% = 41.5% Swedish.</p>
<p>So why is 15% impossible? Or, for that matter, all the numbers in the previous example: 17%, 66%, 41.5%? The reason is that any person’s Swedishness must be a fraction which, in lowest terms, must have a denominator that is a power of 2. There’s an easy proof by induction. Initially everyone is either entirely Swedish or entirely non-Swedish. In lowest terms these fractions can be expressed as 1/1 and 0/1, respectively. The denominator, 1, is a power of 2 (fyi <span class="math">\(2^0 = 1\)</span>). Now, assuming a mom and dad are Swedish in proportions <span class="math">\(m/2^M\)</span> and <span class="math">\(d/2^D\)</span> respectively, their offspring will be this Swedish:</p>
<p><span class="math">\[\frac{2^Dm + 2^Md}{2^{D+M+2}}\]</span></p>
<p>The denominator is a power of 2, and reducing this fraction to lower terms will not change that fact. Numbers like 15%, a.k.a. 15/100, or 3/20 in lowest terms, have denominators which aren’t powers of 2, and that’s why no one can ever really be 15% Swedish.</p>
<h2 id="but-what-if">But what if…?</h2>
<p>What if we keep the assumption that Swedishness is determined equally by the parents’ Swedishnesses, but without assuming there was some point in time where everyone was either entirely Swedish or entirely non-Swedish? Let’s weaken that assumption to simply state that every person has an ancestor that’s either entirely Swedish or entirely non-Swedish. And let’s do one more crazy thing: let’s allow human history to go back infinitely through the generations, with no beginning. So there could be an infinitely long lineage of Swedes without there being a first Swede. If it helps, imagine a family tree that’s infinitely tall, with no original top level. In this universe of bastardized metaphysics, can you be 15% Swedish? Why yes!</p>
<h2 id="binary-numbers-and-trees">Binary numbers and trees</h2>
<p>We know how decimal numbers work. 12.34 as a decimal number means</p>
<p><span class="math">\[1 \times 10^1 + 2 \times 10^0 + 3 \times 10^{-1} + 4 \times 10^{-2}\]</span></p>
<p>Binary numbers work the same way, with 2’s instead of 10’s. So the number four is:</p>
<p><span class="math">\[1 \times 2^2 + 0 \times 2^1 + 0 \times 2^0\]</span></p>
<p>So it’s represented as <span class="math">\(100\)</span> in binary. Similarly one-half is:</p>
<p><span class="math">\[0 \times 2^0 + 1 \times 2^{-1}\]</span></p>
<p>So it’s represented as <span class="math">\(0.1\)</span> in binary. What about a number like one-third? It’s equal to the value of the following infinite sum:</p>
<p><span class="math">\[0 \times 10^0 + 3\times 10^{-1} + 3\times 10^{-2} + \dots\]</span></p>
<p>So it’s represented as <span class="math">\(0.33&#8230;\)</span> in decimal. It’s also equal to the following infinite sum:</p>
<p><span class="math">\[0 \times 2^0 + 0 \times 2^{-1} + 1 \times 2{-2} + 0 \times 2^{-3} + 1 \times 2^{-4} + 0 \times 2^{-5} + 1 \times 2^{-6} + \dots\]</span></p>
<p>So it’s represented as <span class="math">\(0.010101&#8230;\)</span> in binary.</p>
<p>Now why do we care? Well, if you’ve read this far, then you care because you can use the binary representation of a number to figure out what a person’s family tree could look like if their Swedishness was equal to that number. For example, how can you be <span class="math">\(1/2\)</span> Swedish? Well <span class="math">\(0.1\)</span> is the binary representation of <span class="math">\(1/2\)</span>, and this tells us that if we have 1 parent who is entirely Swedish (and hence all the ancestors on that side are entirely Swedish), and one parent who is entirely non-Swedish (along with all their ancestors), then you can be 1/2 Swedish.</p>
<p>How about a more involved example. To be <span class="math">\(3/16\)</span> Swedish, which is <span class="math">\(0.0011\)</span> in binary, you can accomplish this by first having 1 great-grandparent who is entirely Swedish, let’s call her Agnetha. Agnetha’s parents will of course have to be entirley Swedish too. In addition to them you’ll need one more great-great-grandparent who’s entirley Swedish, let’s call him Bjorn. If you have great-grandma Agnetha and great-great-grandpa Bjorn who are entirely Swedish (as must be all their ancestors), and if all of your ancestors who aren’t descendents of Agnetha and Bjorn are entirely non-Swedish, then you’ll be exactly <span class="math">\(3/16\)</span> Swedish. How does this look in terms of your family tree? If we say you are at level 0, your parents at level 1, etc. then what we get is the following:</p>
<p>The first full Swede is Agnetha, on level 3.<br />The next full Swede who isn’t logically “forced” to be Swedish on account of being Agnetha’s ancestor is Bjorn, on level 4.<br />There are no other full Swedes except Agnetha’s and Bjorn’s ancestors.<br />Everyone else is entirely non-Swedish unless they’re “forced” to be a bit Swedish on account of being descendents of Agnetha and/or Bjorn.</p>
<p>Notice how the “level 3” and “level 4” correspond to the locations of the 1’s in the binary expansion of 3/16? If you go back to the simpler example of 1/2, which was <span class="math">\(0.1\)</span> in binary, you’ll see that we have one full Swede on level 1 and everyone except that person’s ancestors is fully non-Swedish.</p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>So here’s how you can be 15% Swedish:</p>
<ol type="1">
<li>Express 15% in binary, it’ll be infinitely long.</li>
<li>Use the binary number as a recipe for marking the certain nodes at certain levels of an infinite binary (family) tree as “entirely Swedish”.</li>
<li>Any ancestor of one of the marked nodes also gets marked as “entirely Swedish”, and any node that’s not an ancestor or descendent of a marked node is entirely non-Swedish. Every remaining node is Swedish to the degree determined by its parents.</li>
<li>The person at the root of this family tree will be the desired 15% Swedish.</li>
</ol>
<p><span class="math">\[15\% = 2^{-3} + 2^{-6} + 2^{-7} + 2^{-10} + \dots\]</span></p>
<p>So if you have great-grandma Agnetha, great-great-great-great-grandpa Bjorn, great-great-great-great-great-granpa Benny, and great-great-great-great-great-great-great-great-grandma Anni-Frid, …. And all of them are entirely Swedish, and none of them are ancestors/descendents of one another. And if anyone else on your family tree that isn’t a blood relative of theirs is entirely non-Swedish. Then you will be 15% Swedish!</p>
<h2 id="back-to-real-life-sort-of">Back to real life, sort of</h2>
<p>Okay, so all that was incredibly silly. Can we say anything that’s merely very silly? Say you want to know if you can be 15% Swedish in real life, but within some error bounds. Maybe you want to know if you can be 15% Swedish, give or take 1%. Easy: find a <em>finitely-long</em> binary number that’s between 0.14 and 0.16, and repeat the above steps with that number. One simple way to do that is to start finding the binary expansion of 0.15, and stopping once you’re within the desired range:</p>
<p><span class="math">\(2^{-3}\)</span>?<br />Nope, that’s 0.125, too small.<br /><span class="math">\(2^{-3} + 2^{-6}\)</span>?<br />Yup, that’s 0.140625.</p>
<p>Could we have known ahead of time how much of the binary expansion of 0.15 we’d have to calculate before reaching the desired range? Yup, we can do that too. Once you’ve started writing a binary number out to <span class="math">\(n\)</span> digits, no matter what digits you add on next, the most you can add to your current number is <span class="math">\(2^{-n}\)</span>. For example, all the binary numbers that start with <span class="math">\(0.11010&#8230;\)</span> must be within <span class="math">\(2^{-5} = 0.03125\)</span> of one another. So if I know I want to be within <span class="math">\(0.01\)</span> (in decimal, i.e. 1%) of 15%, I just have to apply the above reasoning backwards. <span class="math">\(\log _2(0.01) ~ -4.605&#8230;\)</span> so if I figure things out back more than 4.605 generations, that’s enough. So I really only need to figure things out 5 generations back. 5 generations back I have 32 ancestors. The closest fraction of the form x/32 to 0.15 is 5/32. So I know that if I have exactly 5 totally Swedish level-5 ancestors and the remaining 27 level-5 ancestors are totally non-Swedish, I will be within 1% of being 15% Swedish (I’ll be 15.625% Swedish to be exact).</p>
<figure>
<img src="http://images3.wikia.nocookie.net/__cb20080726160313/muppet/images/thumb/3/34/Swedishchef-myspace.jpg/300px-Swedishchef-myspace.jpg" />
</figure>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[So you still don't understand Hindley-Milner?]]></title>
    <link href="http://akgupta.ca/blog/2013/05/14/so-you-still-dont-understand-hindley-milner/"/>
    <updated>2013-05-14T01:12:00-07:00</updated>
    <id>http://akgupta.ca/blog/2013/05/14/so-you-still-dont-understand-hindley-milner</id>
    <content type="html"><![CDATA[<p>I was out for drinks with some friends from work, and one of them found out I “speak math.” He had come across <a href="http://stackoverflow.com/questions/12532552/what-part-of-milner-hindley-do-you-not-understand">this StackOverflow question</a> and asked me what it meant:</p>
<p><img src="http://i.stack.imgur.com/hZhjl.png" /><br /><br></p>
<p>Before we figure out what it means, let’s get an idea for why we care in the first place. <a href="http://www.codecommit.com/blog/scala/what-is-hindley-milner-and-why-is-it-cool">Daniel Spiewak’s blog post</a> gives a really nice explanation of the purpose of the HM algorithm, in addition to an in-depth example of its application:</p>
<blockquote>
<p>Functionally speaking, Hindley-Milner (or “Damas-Milner”) is an algorithm for inferring value types based on use.  It literally formalizes the intuition that a type can be deduced by the functionality it supports.</p>
</blockquote>
<p>Okay, so we want to formalize an algorithm for inferring types of any given expression. I’m going to quickly touch on what it means to formalize something, then describe the building blocks of the HM formalization, and finally translate that StackOverflow question.</p>
<h2 id="what-it-means-to-formalize">What it means to formalize</h2>
<p>Okay, so we want to talk about expressions. Arbitrary expressions. In an arbitrary language. And we want to talk about inferring types of these expressions. And we want to figure out rules for how we can infer types. And then we’re going to want to make an algorithm that uses these rules to infer types. So we’re going to need a meta-language. A language to talk about expressions in an arbitrary programming language. This meta-language should:</p>
<ul>
<li>Be abstract and generic, so that it allows us to reason about statements of type inference purely based on their <em>form</em> (hence, <em>formalization</em>), without having to worry about their content.</li>
<li>Give a precise, unambiguous, yet intuitive definition for what an expression is.</li>
<li>Give those definitions in terms of a small number of uncontroversial primitive concepts.</li>
<li>Similarly give definitions for types, the idea that an expression has a type, and the idea that we can infer that a given expression has a given type.</li>
<li>Lend itself to a simple, terse symbolic representation, e.g. rather than saying “the expression formed by applying the first expression to the second expression has the type of a function from strings to some type we don’t care to specify in the current context” we could simply say “<span class="math">\(e_1(e_2):\mathrm{String} \rightarrow t\)</span>”.</li>
<li>Be easily translated to something a computer can understand and implement, so we can ultimately automate type inference.</li>
</ul>
<p>To make all that a little more concrete, let’s look at a really quick example of a formalization. If, instead of formalizing a language for talking about inferring types of expressions in an arbitrary programming language, what if we wanted to formalize a language for talking about truths of sentences in arbitrary natural languages? Without formalization, we might say something like</p>
<blockquote>
<p>Suppose I know that if it’s raining, Bob will carry an umbrella.<br />And suppose I also know that it’s raining.<br />Then, I can conclude that Bob will carry an umbrella.</p>
<p>And any argument that takes this form is a valid way to reason.</p>
</blockquote>
<p>Propositional Calculus formalizes that whole things as a rule known as Modus Ponens:</p>
<p><span class="math">\[\underline{A,\ \ A \rightarrow B}\]</span> <span class="math">\[B\]</span></p>
<p>where <span class="math">\(A\)</span> and <span class="math">\(B\)</span> are variables representing propositions (a.k.a. sentences or clauses) in an arbitrary natural language.</p>
<p>Okay, so let’s enumerate the building blocks of the HM formalization:</p>
<h2 id="building-blocks-of-the-formalization">Building blocks of the formalization</h2>
<p>We will need:</p>
<ol type="1">
<li>A formal way to talk about expressions. This formalization should meet the criteria enumerated above; for this purpose we use the <strong>Lambda Calculus</strong>. I’ll be explaining that in a minute, but there’s nothing crazy going on here.</li>
<li>A formal way to talk about types, and a formal way to talk about expressions and types together. After all, the purpose of the HM algorithm is to be able to deduce statements of the form “expression <span class="math">\(e\)</span> has type <span class="math">\(t\)</span>”.</li>
<li>A formal set of rules for deriving statements about expression types from other such statements. Rules along the lines of: “if I can already demonstrate that some expression has this type, and another expression has that type, then this third expression has this other type”. <em>Such a set of rules is exactly what you’re seeing in that SO question</em>. I’ll be translating this in full detail.</li>
<li>An algorithm that intelligently uses the deduction rules to get from a starting point to deducing/inferring a desired conclusion statement: “the expression <span class="math">\(e\)</span> that I’m interested in has type <span class="math">\(t\)</span>”. This is the “algorithm” part for the “HM algorithm”, and that’s not something I’ll be going into in this post.</li>
</ol>
<h2 id="formalizing-the-concept-of-an-expression">Formalizing the concept of an expression</h2>
<p>We’ll give a <a href="http://en.wikipedia.org/wiki/Recursive_definition">recursive definition</a> of what an expression is; in other words, we’ll state what the most basic kind of expression is, we’ll say how to create new, more complex expressions out of existing expressions, and we’ll say that only things made in this way are valid expressions.</p>
<ol type="1">
<li>Variables are valid expressions.<br /></li>
<li>If <span class="math">\(e\)</span> is any expression, and <span class="math">\(x\)</span> is any variable, then <span class="math">\(\lambda x.e\)</span> is an expression. Here it helps to think of e as typically (thought not necessarily) a more complex expression involving <span class="math">\(x\)</span>, e.g. <span class="math">\(x^2+2\)</span>, and then <span class="math">\(\lambda x.e\)</span> as the anonymous function that takes an input <span class="math">\(x\)</span> and returns the result of evaluating the expression <span class="math">\(e\)</span> with the given value of <span class="math">\(x\)</span>. In other words, think of it like this:<br />
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div></li>
<li>If <span class="math">\(f\)</span> and <span class="math">\(e\)</span> are valid expressions, and <span class="math">\(f\)</span> can take arguments (e.g. if it’s an abstraction like explained in point 2), then <span class="math">\(f(e)\)</span> is a valid expression. This is called Application, for obvious reasons.</li>
<li>If <span class="math">\(x\)</span> is a variable, and <span class="math">\(e_1\)</span> and <span class="math">\(e_0\)</span> are valid expressions, then substituting every occurrence of <span class="math">\(x\)</span> in <span class="math">\(e_0\)</span> for <span class="math">\(e_1\)</span> yields a valid expression. So, for example, if <span class="math">\(e_0\)</span> is the expression <span class="math">\(x^2 + 2\)</span>, and <span class="math">\(e_0\)</span> is the expression <span class="math">\(y/3\)</span>, then if we let <span class="math">\(x = e_0\)</span> in <span class="math">\(e_1\)</span>, we get the expression <span class="math">\((y/3)^2 + 2\)</span>.</li>
</ol>
<p>And nothing else is a valid expression.</p>
<p>Aside: anyone paying close attention will wonder, wait, how can I make any useful expressions out of this? How do I even get <span class="math">\(x^2 + 2\)</span>, or in fact <span class="math">\(2\)</span> for that matter, out of the above? Heck, what about <span class="math">\(0\)</span>? There is nothing in the rules above which <em>obviously</em> yield the expression <span class="math">\(0\)</span>. The solution is to create expressions in the Lambda Calculus which behave like <span class="math">\(0, 1, \dots, +, \times, -, /\)</span> when interpreted correctly. In other words, we have to encode numbers, numerical operations, strings, etc. into patterns we can create with the Lambda syntax. <a href="http://palmstroem.blogspot.com/2012/05/lambda-calculus-for-absolute-dummies.html">This blog post</a> has a nice little section on numbers and numerical operations. This is a great feature of the Lambda Calculus: we have a simple syntax which we can define recursively in 4 simple clauses, and this therefore allows us to prove many things about it inductively in 4 main steps, yet the language itself has the expressive power to capture numbers, strings, and all the types and operations we could ever care about.</p>
<h2 id="formalizing-statements-about-types">Formalizing statements about types</h2>
<p>Let <span class="math">\(e\)</span> be any expression, that is, “<span class="math">\(e\)</span>” is a variable in our meta-language which stands for any expression in our base language, like any of the following:</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">x</span>
</span><span class='line'><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">].</span><span class="nx">forEach</span> <span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">print</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>Then if <span class="math">\(t\)</span> is any type, we can express “<span class="math">\(e\)</span> is of type <span class="math">\(t\)</span>” by</p>
<p><span class="math">\[e:t\]</span></p>
<p>Just like <span class="math">\(e\)</span>, <span class="math">\(t\)</span> is a variable in our meta-language, and it can stand for any type in the base language, like <span class="math">\(\mathrm{Int}\)</span>, <span class="math">\(\mathrm{String}\)</span>, etc. And just like <span class="math">\(e\)</span>, <span class="math">\(t\)</span> doesn’t necessarily need to stand for any one type in particular.</p>
<p>One can give a formal definition for what counts as a type, just as we did for expressions above. However the abstraction gets fairly twisted, so we’ll leave it at that. I should just point out a few two key things to keep in mind:</p>
<ol type="1">
<li>If <span class="math">\(s\)</span> and <span class="math">\(t\)</span> are types, then so is <span class="math">\(t \rightarrow s\)</span>; it’s the type of a function with <span class="math">\(t\)</span> inputs and <span class="math">\(s\)</span> outputs.<br /></li>
<li>If <span class="math">\(r\)</span> is a type, possibly made up of other types (just as <span class="math">\(t \rightarrow s\)</span> is made up of <span class="math">\(t\)</span> and <span class="math">\(s\)</span>, which could each potentially have been made up of other types), and <span class="math">\(\alpha\)</span> is a variable for a type, then <span class="math">\(\forall \alpha.r\)</span> is a type. That makes no sense without an example:</li>
</ol>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>This function is type <span class="math">\(\mathrm{String} \rightarrow \mathrm{String}\)</span>. But it’s also <span class="math">\(\mathrm{Int} \rightarrow \mathrm{Int}\)</span>. In fact, for any type <span class="math">\(t\)</span>, it’s type <span class="math">\(t \rightarrow t\)</span>. We’re gonna say that it has type <span class="math">\(\forall t. t \rightarrow t\)</span>. Each of the types <span class="math">\(\mathrm{String} \rightarrow \mathrm{String}\)</span>, <span class="math">\(t \rightarrow t\)</span>, are “monotypes”. <span class="math">\(\forall t. t \rightarrow t\)</span> is a “polytype”. The identity function above has the abstract polytype <span class="math">\(\forall t. t \rightarrow t\)</span> which, in practice, means that for every real type <span class="math">\(t\)</span>, it has type <span class="math">\(t \rightarrow t\)</span>. If all of this has been sinking in, then we can compactly express this as:</p>
<p><span class="math">\[\lambda x.x:\forall\alpha.\alpha \rightarrow \alpha\]</span></p>
<h2 id="formalizing-statements-about-statements-about-types">Formalizing statements about statements about types</h2>
<p>Now we’re going to want to formalize a bunch of rules for how we can go from some knowledge of expressions and their types to inferring types of more expressions. Remember how propositional calculus formalized Modus Ponens? We’re going to do something similar. For instance, say we want to formalize the following piece of reasoning:</p>
<blockquote>
<p>Suppose I’ve already been able to infer that a variable <code>duck</code> has type <code>Animal</code>.<br />Suppose furthermore that I’ve inferred that <code>speak</code> is a method of type <code>Animal -&gt; String</code>.<br />Then I can infer that <code>speak(duck)</code> has type String.</p>
<p>And any reasoning of this form is valid type inference.</p>
</blockquote>
<p>We’ll formalize that as follows:</p>
<p><span class="math">\[\underline{\Gamma\vdash e_0:\tau\rightarrow\tau &#39;\ \ \ \Gamma\vdash e_1:\tau}\]</span> <span class="math">\[\Gamma\vdash e_0(e_1):\tau \rightarrow \tau &#39;\]</span></p>
<p>Let’s first get a handle on all the symbols you see above:</p>
<ul>
<li><span class="math">\(\Gamma\)</span>, this will stand for the collection of statements we already know, or perhaps, the statements we’re assuming. More generally, <span class="math">\(\Gamma\)</span> should just be thought of as some collection of statements (about expressions and their types). And of course, there’s nothing special about the letter <span class="math">\(\Gamma\)</span>; capital greek letters are commonly used for sets of statements however.<br /></li>
<li><span class="math">\(\vdash\)</span>, the “turnstile”, denotes that something can be inferred. For instance, <span class="math">\(\Gamma \vdash x:t\)</span> says that if we take the statements in <span class="math">\(\Gamma\)</span> as our assumptions/axioms/current knowledge, then we can infer that <span class="math">\(x\)</span> has type <span class="math">\(t\)</span>.<br /></li>
<li><span class="math">\(\in\)</span>, “epsilon”, denotes membership. <span class="math">\(x:t \in \Gamma\)</span> says that the statement <span class="math">\(x:t\)</span> is a member of <span class="math">\(\Gamma\)</span>.</li>
<li>That long horizontal bar; this line tells us that we can make the conclusion below the line if the things above the line are taken as premises in the argument. It lets us express things like, “if we can infer such and such, then we can infer such and such”, e.g.</li>
</ul>
<p><span class="math">\[\underline{\Gamma \vdash y:\sigma}\]</span> <span class="math">\[\Gamma \vdash x:\tau\]</span></p>
<p>If we can infer that <span class="math">\(y\)</span> has type <span class="math">\(\sigma\)</span> from <span class="math">\(\Gamma\)</span>, then we can infer <span class="math">\(x\)</span> has type <span class="math">\(\tau\)</span> from <span class="math">\(\Gamma\)</span>.</p>
<h2 id="the-rules-for-deducing-statements-about-type-inference">The rules for deducing statements about type inference</h2>
<p>So let’s get down to it.</p>
<p>[Var]</p>
<p><span class="math">\[\underline{x:\sigma \in \Gamma}\]</span> <span class="math">\[\Gamma \vdash x:\sigma\]</span></p>
<p>This translates to: If “<span class="math">\(x\)</span> has type <span class="math">\(\sigma\)</span>” is a statement in our collection of statements <span class="math">\(\Gamma\)</span>, then from <span class="math">\(\Gamma\)</span> you can infer that <span class="math">\(x\)</span> has type <span class="math">\(\sigma\)</span>. Here <span class="math">\(x\)</span> is a variable (hence the name of this rule of inference). Yes, it should sound that painfully obvious. The terse, cryptic way that [Var] is expressed isn’t that way because it contains some deep, difficult fact. It’s terse and succinct so that a machine can understand it and type inference can be automated.</p>
<p>[App]</p>
<p><span class="math">\[\underline{\Gamma\vdash e_0:\tau\rightarrow\tau &#39;\ \ \ \Gamma\vdash e_1:\tau}\]</span> <span class="math">\[\Gamma\vdash e_0(e_1):\tau \rightarrow \tau &#39;\]</span></p>
<p>This translates to: If we can infer that <span class="math">\(e_0\)</span> is an expression whose type is <span class="math">\(\tau \rightarrow \tau &#39;\)</span> (e.g. <span class="math">\(e_0\)</span> might be an anonymous function which, according to <span class="math">\(\Gamma\)</span>, takes input of type <span class="math">\(\tau\)</span> and returns output of type <span class="math">\(\tau &#39;\)</span>), and we can infer that <span class="math">\(e_1\)</span> has type <span class="math">\(\tau\)</span>, then we may deduce that we can infer that <span class="math">\(e_0(e_1)\)</span>, the expression obtained by applying <span class="math">\(e_0\)</span> to <span class="math">\(e_1\)</span>, has type <span class="math">\(\tau &#39;\)</span>. The intuitive gist is if we can infer the types of the input and output of a function, and we can infer some expression has the same type as the input of the function, then when we apply the function to that expression, we can infer the result expression has the type of the output of the function. Nothing bewildering here. By the way, this is the formalization of our <code>speak(duck)</code> example.</p>
<p>[Abs]</p>
<p><span class="math">\[\underline{\ \ \Gamma, x:\tau \vdash e:\tau &#39;\ \ }\]</span> <span class="math">\[\Gamma \vdash \lambda x.e:\tau \rightarrow \tau &#39;\]</span></p>
<p>This translates to: If allowing us to assume that <span class="math">\(x\)</span> has type <span class="math">\(\tau\)</span> we were able to infer that <span class="math">\(e\)</span> has type <span class="math">\(\tau &#39;\)</span>, then we may deduce that we can infer that the abstraction/anonymization of <span class="math">\(e\)</span> with respect to the variable <span class="math">\(x\)</span>, <span class="math">\(\lambda x.e\)</span>, has type <span class="math">\(\tau \rightarrow \tau &#39;\)</span>. So, for example, we know that if <span class="math">\(x\)</span> has type <span class="math">\(\mathrm{String}\)</span>, then the expression <span class="math">\(x[0]\)</span> has type <span class="math">\(\mathrm{Char}\)</span>. Now [Abs] allows us to deduce that</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>has type <span class="math">\(\mathrm{String} \rightarrow \mathrm{Char}\)</span>.</p>
<p>Aside. I mentioned polytypes earlier. Let’s revisit them it in this example, just to help hammer it home. So note that this function above also has type <span class="math">\(\mathrm{Array}[\mathrm{Int}] \rightarrow \mathrm{Int}\)</span>. In fact, for any type <span class="math">\(t\)</span>, the function has type <span class="math">\(\mathrm{Array}[t] \rightarrow t\)</span>. So it has many different types, <span class="math">\(\mathrm{String} \rightarrow \mathrm{Char}\)</span> being just one of them. <em>Each</em> of its types of the form <span class="math">\(\mathrm{Array}[t] \rightarrow t\)</span> is monotype. We can express that this function has <em>all</em> of these monotypes by saying that it has the polytype <span class="math">\(\forall t(\mathrm{Array}[t] \rightarrow t)\)</span>. We read that as “for all <span class="math">\(t\)</span>, the type <span class="math">\(\mathrm{Array}[t] \rightarrow t\)</span>” and we treat that whole thing as a single, yet more abstract, type. So note that when we infer the type of some expression, that doesn’t mean that said type is the <em>only</em> type of that expression. An expression can have many types, and some of these types can be specializations of more abstract types. The simplest kinds of types are monotypes: <span class="math">\(\mathrm{Int}\)</span>, <span class="math">\(\mathrm{String}\)</span>, <span class="math">\(\mathrm{String} \rightarrow \mathrm{Char}\)</span>, etc. but we can have more abstract/general types called polytypes.</p>
<p>[Let]</p>
<p><span class="math">\[\underline{\Gamma \vdash e_0:\sigma\ \ \ \ \Gamma , x:\sigma \vdash e_1 : \tau}\]</span> <span class="math">\[\Gamma \vdash \mbox{let } x = e_0 \mbox{ in } e_1:\tau\]</span></p>
<p>Easy:</p>
<p>If we can infer that <span class="math">\(e_0\)</span> has type <span class="math">\(\sigma\)</span>, and<br />If we were to assume <span class="math">\(x\)</span> had type <span class="math">\(\sigma\)</span> we could infer that <span class="math">\(e_1\)</span> has type <span class="math">\(t\)</span>,<br />Then we may deduce that we can infer that the result of letting <span class="math">\(x = e_0\)</span>, and substituting it into <span class="math">\(e_1\)</span>, has type <span class="math">\(t\)</span>.</p>
<p>These last four rules do nothing more than formally capture our intuition about what type inferences we can make when we have variables and we do things like create anonymous functions, apply functions, and substitute expressions into other expressions. It’s something we as programmers can do intuitively, and here we’re just saying that this is something we can formally describe, what’s happening in our brains isn’t necessarily magical. It’s also worth noting that these last four rules correspond precisely with the four rules for defining what a valid expression is in the Lambda Calculus. This is not a coincidence.</p>
<p>[Inst]</p>
<p><span class="math">\[\underline{\Gamma \vdash e:\sigma &#39;\ \ \ \ \sigma &#39;\sqsubseteq \sigma}\]</span> <span class="math">\[\Gamma \vdash e:\sigma\]</span></p>
<p>This is about instantiation. You can think of the monotype <span class="math">\(\mathrm{Array}[\mathrm{Int}] \rightarrow \mathrm{Int}\)</span> as an instantiation of the polytype <span class="math">\(\forall t. \mathrm{Array}[t] \rightarrow t\)</span>. Another word for this is “specialization”: <span class="math">\(\mathrm{Array}[\mathrm{Int}] \rightarrow \mathrm{Int}\)</span> is more special than for <span class="math">\(\forall t.\mathrm{Array}[t] \rightarrow t\)</span>. We denote the “more special than” relation between types with <span class="math">\(\sqsubseteq\)</span>. So</p>
<p><span class="math">\[\forall t. \mathrm{Array}[t] \rightarrow t \ \ \sqsubseteq\ \  \mathrm{Array}[t] \rightarrow t\]</span></p>
<p>So the direct translation of [Inst] is: If we can infer <span class="math">\(e\)</span> has type <span class="math">\(\sigma &#39;\)</span>, and <span class="math">\(\sigma\)</span> is a specialization/instantiation of <span class="math">\(\sigma &#39;\)</span>, then we can deduce that we can infer that <span class="math">\(e\)</span> has type <span class="math">\(\sigma\)</span>. And you can think of <span class="math">\(\sigma\)</span> and <span class="math">\(\sigma &#39;\)</span> as being types like <span class="math">\(\mathrm{Array}[t] \rightarrow t\)</span> and <span class="math">\(\forall t. \mathrm{Array}[t] \rightarrow t\)</span> respectively.</p>
<p>[Gen]</p>
<p><span class="math">\[\underline{\Gamma \vdash e:\sigma\ \ \ \ \alpha \notin \mathrm{free}(\Gamma)}\]</span> <span class="math">\[\Gamma \vdash e:\forall \alpha.\sigma\]</span></p>
<p>This is the hardest one to understand. It really only makes sense in the context of doing a type inference using these restricted set of rules we’re outlining. It doesn’t have a very concrete analogue since it heavily depends on the concept of a variable type, something that never occurs in any real programming language, but is an indispensable concept when we’re trying to work in a meta-language that talks about types in any arbitrary real programming language. The idea can sort of be captured in this “example”:</p>
<p>Suppose you have some variables <span class="math">\(x\)</span> and <span class="math">\(y\)</span>, and for the time being you’re assuming they have type <span class="math">\(\alpha\)</span>, where <span class="math">\(\alpha\)</span> is a variable standing for a type. You later come across an expression that you somehow manage to infer has type <span class="math">\(\alpha \rightarrow \alpha\)</span> in <em>this</em> context (the context where you’re assuming <span class="math">\(x\)</span> and <span class="math">\(y\)</span> have type <span class="math">\(\alpha\)</span>). The question is, will this function have the polytype <span class="math">\(\forall \alpha. \alpha \rightarrow \alpha\)</span>? I.e. does this function generally map objects to things of the same type, or does that only appear to be the case because you assumed <span class="math">\(x\)</span> and <span class="math">\(y\)</span> had the same type <span class="math">\(\alpha\)</span>?</p>
<p>Since <span class="math">\(\alpha\)</span> is a variable type, i.e. it could stand for any type, we might like to think that, since we’ve inferred that <span class="math">\(e\)</span> has type <span class="math">\(\alpha \rightarrow \alpha\)</span> that it has the polytype <span class="math">\(\forall \alpha. \alpha \rightarrow \alpha\)</span>. But we can’t necessarily make this generalization without more insight into how <span class="math">\(e\)</span> is related to <span class="math">\(x\)</span> and <span class="math">\(y\)</span>; In particular, if our inference that it has type <span class="math">\(\alpha \rightarrow \alpha\)</span> is tightly coupled to our prior assumptions involving <span class="math">\(\alpha\)</span>, then we shouldn’t conclude that it generally has the polytype <span class="math">\(\forall \alpha .\alpha \rightarrow \alpha\)</span>.</p>
<p>Here’s the translation:</p>
<p>If some variable type <span class="math">\(\alpha\)</span> hasn’t “freely” been mentioned in our current context/set of knowledge/assumptions, and we can infer that some expression <span class="math">\(e\)</span> has some type <span class="math">\(\sigma\)</span>, then we can infer that <span class="math">\(e\)</span> has type <span class="math">\(\sigma\)</span> independent of what <span class="math">\(\alpha\)</span> turns out to be. Slightly more technically, <span class="math">\(e\)</span> has the polytype <span class="math">\(\forall \alpha . \sigma\)</span>.</p>
<p>Okay, but what does “freely mentioned” mean? In a polytype like <span class="math">\(\forall \alpha . \alpha \rightarrow \alpha\)</span>, <span class="math">\(\alpha\)</span> isn’t “really” being mentioned. That type is the exact same as this one: <span class="math">\(\forall \beta . \beta \rightarrow \beta\)</span>. An expression with either type is just that of a function that sends any type to itself. On the other hand, <span class="math">\(x:\alpha\)</span> “really” does mention <span class="math">\(\alpha\)</span>.</p>
<p><span class="math">\[x:\alpha\]</span> <span class="math">\[y:\beta\]</span></p>
<p>and</p>
<p><span class="math">\[x:\alpha\]</span> <span class="math">\[y:\alpha\]</span></p>
<p>mean different things. The latter means <span class="math">\(x\)</span> and <span class="math">\(y\)</span> definitely have the same type (even though what that type is may not have been pinned down). The former tells you nothing about how the types of <span class="math">\(x\)</span> and <span class="math">\(y\)</span> are related. The difference is, when <span class="math">\(\alpha\)</span> is mentioned inside the scope of a <span class="math">\(\forall\)</span>, as is the case in <span class="math">\(\forall \alpha . \alpha \rightarrow \alpha\)</span>, that <span class="math">\(\alpha\)</span> is just a dummy, and can be swapped out for any other type variable regardless of the rest of the context. So we can interpret the statement “<span class="math">\(\alpha\)</span> isn’t freely mentioned in the context <span class="math">\(\Gamma\)</span>” to say, “<span class="math">\(\alpha\)</span> is either never mentioned at all, or, if it is, it’s only ever mentioned as a dummy and could in principle be swapped out for something entirely different without changing the semantics of the assumptions/knowledge in our context.”</p>
<p>And that’s it. Questions? Comments? Let me know.</p>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting up PostgreSQL with MacPorts for Ruby on Rails development]]></title>
    <link href="http://akgupta.ca/blog/2013/05/11/setting-up-postgresql-with-macports-for-ruby-on-rails-development/"/>
    <updated>2013-05-11T13:39:00-07:00</updated>
    <id>http://akgupta.ca/blog/2013/05/11/setting-up-postgresql-with-macports-for-ruby-on-rails-development</id>
    <content type="html"><![CDATA[<p>This post is pretty much just what the title says. If you develop in Rails, on a Mac, using PostgreSQL as your database and MacPorts as your package management system of choice, it can be hard to get everything set up and going. This is especially true if you’re new to absolutely everything, which was my situation when I first tried to do this. Part of what was hard was that most of the advice on the Internet was just a bunch of commands to run with little explanation, so it was hard to know what you had to do to customize it for your environment. So this explanation is hopefully a little more thorough. However, if you’re impatient and just want the <strong>TL;DR</strong>, here it is (with several implicit assumptions):</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo port install postgresql92-server
</span><span class='line'>sudo mkdir -p /opt/local/var/db/postgresql92/defaultdb
</span><span class='line'>sudo chown postgres:postgres /opt/local/var/db/postgresql92/defaultdb
</span><span class='line'>sudo su postgres -c <span class="s1">&#39;/opt/local/lib/postgresql92/bin/initdb -D /opt/local/var/db/postgresql92/defaultdb&#39;</span>
</span><span class='line'>sudo su postgres
</span><span class='line'>/opt/local/lib/postgresql92/bin/pg_ctl -D /opt/local/var/db/postgresql92/defaultdb/ -l /opt/local/var/db/postgresql92/defaultdb/server.log start
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;PATH=/opt/local/lib/postgresql92/bin/:$PATH&#39;</span> &gt;&gt; ~/.bashrc
</span><span class='line'><span class="nb">source</span> ~/.bashrc
</span><span class='line'>rails new my_app --database<span class="o">=</span>postgresql
</span><span class='line'>sed -e <span class="s1">&#39;s/username: my_app/username: postgres/g&#39;</span> -i <span class="s1">&#39;&#39;</span> my_app/config/database.yml
</span><span class='line'><span class="nb">cd </span>my_app
</span><span class='line'>rake db:create:all
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>In order to use a PostgreSQL database for development, you’ll need, in addition to the PostgreSQL package itself, a PostgreSQL server for your application to talk to. The PostgreSQL server package has the basic PostgreSQL package as a dependency, so we’ll just run the command to install the server and we’ll get both. The <strong>server</strong> package will allow you to run a process that serves your database, and the basic package provides a <strong>client</strong> that your Rails app will use to connect to and interact with (read, write, etc.) the database being served.</p>
<p>Pick the version of PostgreSQL you want to install. At the time I wrote this, the latest was 9.2.x so we’ll go with that:</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo port install postgresql92-server
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>You’ll likely see the following instructions in the installation output</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>To create a database instance, after install <span class="k">do</span>
</span><span class='line'><span class="k"> </span>sudo mkdir -p /opt/local/var/db/postgresql92/defaultdb
</span><span class='line'> sudo chown postgres:postgres /opt/local/var/db/postgresql92/defaultdb
</span><span class='line'> sudo su postgres -c <span class="s1">&#39;/opt/local/lib/postgresql92/bin/initdb -D</span>
</span><span class='line'><span class="s1">/opt/local/var/db/postgresql92/defaultdb&#39;</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>Now in order to start a PostgreSQL server process, it needs an initial database cluster within which you will create your databases. To do this you need to create a directory for an initial database cluster and tell PostgreSQL to initialize that directory for use with a PostgreSQL database cluster. PostgreSQL doesn’t allow the superuser to initialize a database cluster. The user used to initialize the database cluster should be one that will exist on any machine that has PostgreSQL, allowing you to collaborate on your Rails app with people using different machines, thus it makes sense to use the ‘postgres’ user. The above commands will:</p>
<ol type="1">
<li>Create the directory for an initial default database cluster</li>
<li>Change ownership of the directory to the ‘postgres’ user</li>
<li>Initializes the directory as a PostgreSQL database cluster on behalf of the ‘postgres’ user.</li>
</ol>
<p>After you do this, you’ll see the following instructions in the output:</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Success. You can now start the database server using:
</span><span class='line'>
</span><span class='line'>    /opt/local/lib/postgresql92/bin/postgres -D /opt/local/var/db/postgresql92/defaultdb
</span><span class='line'>or
</span><span class='line'>    /opt/local/lib/postgresql92/bin/pg_ctl -D /opt/local/var/db/postgresql92/defaultdb -l logfile start
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>The first will start the server in the foreground, which you probably don’t want. The second will start it in the background, but dump a log file in whatever directory you execute the command, which you don’t want either. You’ll also need to start the server as the ‘postgres’ user, which the above command doesn’t do as is, so the solution is to:</p>
<ol type="1">
<li>Switch to the ‘postgres’ user</li>
<li>Issue the above command (with a better path for the log file)</li>
<li>Exit from being the ‘postgres’ user</li>
</ol>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo su postgres
</span><span class='line'>/opt/local/lib/postgresql92/bin/pg_ctl -D /opt/local/var/db/postgresql92/defaultdb/ -l /opt/local/var/db/postgresql92/defaultdb/server.log start
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>Now when you go to create your Rails project, it will install the <code>pg</code> gem for working with PostgreSQL, and it’ll configure itself to use the first <code>psql</code> (PostgreSQL client) it finds in your <code>$PATH</code> environment variable. Your system comes with one, but you’ll want to use the one you just installed. Assuming you’re using a <code>.bashrc</code> (or <code>.bash_profile</code>) file for initial setup of your bash environment for shell sessions, add</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">PATH</span><span class="o">=</span>/opt/local/lib/postgresql92/bin/:<span class="nv">$PATH</span>
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>to the bottom of the <code>.bashrc</code> (or <code>.bash_profile</code>) file. Don’t forget to</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source</span> ~/.bashrc
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>for the change to take effect.</p>
<p>Now that you’re done setting up your system for PostgreSQL, you are ready to create and setup a Rails app that uses PostgreSQL. Start with:</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails new my_app --database<span class="o">=</span>postgresql
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>The standard <code>rails new my_app</code> does a whole bunch of initial setup and file creation for your Rails app. Adding the <code>--database=postgresql</code> flag ensures that your Rails setup includes some PostgreSQL-specific things, such as adding the <code>pg</code> gem to your Gemfile, and pre-populating some of the database configuration properties in the <code>my_app/config/database.yml</code> file. We’ll need to edit that file a little. Go to <code>my_app/config/database.yml</code> and change the username for the development and test databases to ‘postgres’. What this does is ensure that when your Rails app uses the PostgreSQL client to try to access the database cluster served by your PostgreSQL server, it does so with the credentials of the user who owns that cluster, namely the ‘postgres’ user.</p>
<p>While you’re in that file, you can get rid of the section for the production database altogether if you’re deploying to CloudFoundry or Heroku, since they will overwrite whatever you have there anyways.</p>
<p>Finally, create the development and test databases that your Rails app will use. (These databases will be created within your default cluster).</p>
<div class='bogus-wrapper'>
<notextile>
<figure class='code'><figcaption>
<span></span>
</figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake db:create:all
</span></code></pre></td></tr></table></div></figure>
</notextile>
</div>

<p>Now you’re totally ready to go!</p>]]></content>
  </entry>
  
</feed>
